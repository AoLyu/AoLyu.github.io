## DDD从单体到微服务

#### 当前架构问题

![](../../assets/img/2022-08-07/fast_11-32-46.png)

网关可以区分不同层协议，转发到不同节点上去处理。

环境：开发环境，测试环境，预发布环境，生产环境

开发人员从主分支拉回需求分支，然后在自己的开发环境进行开发，开发完成后，我们会把需求分支合并到测试分支，提交给测试人员进行测试。

如果项目非常庞大，首先出现的就是测试环境征用问题，测试环境会变得非常庞大，频繁的部署，甚至不同的环境存在冲突的话，会出现长时间等待测试环境的情况，影响开发效率，

各个需求分支在经过测试环境测试后，一般来说，会把它合并到天分支或这周分支，在进行一次回归测试。这个时候又可能会有问题。如果你的服务太过庞大，里面模块太多，那么每次合并要更新的feature分支也非常多，每个feature分支的开发和验证进度都不一样，合并周版本要等到所有featre分支测试完毕。然后，一旦要发布周版本，所有相关人都得等到深更半夜。通常一两个团队在忙，其他团队在等，等到周版本合并、回归测试完之后，才能发布到预发布版本进行预览。

响应变慢，完成一次用户交互需要多个上下文配合，问题定位 非常复杂。



对系统进行重构：

![](../../assets/img/2022-08-07/fast_13-02-23.png)

节点有可能是一组主机，也可能是一组容器，访问各自独立的DB，开发故障和性能之间不再相互干扰。

#### 微服务的好处

* 技术异构性
* 容错性
* 灵活扩展性
* 简化部署
* 与组织结构匹配
* 可组合型
* 方便替代和升级

 

微服务细节，看springcloud alibaba ， 此处不再记录

#### 服务划分 粒度大小问题

1. DDD使用聚合划分

![](../../assets/img/2022-08-07/fast_13-11-38.png)

2. 按限界上下文进行划分

![](../../assets/img/2022-08-07/fast_13-13-18.png)

#### 方案一：微服务sdk

![](../../assets/img/2022-08-07/fast_15-35-46.png)

####  常见微服务框架

1. SpringBoottwithSpringCIoud
2. GoMirco   (go)
3. Molecular (javascript)
4. Quarkus
5. Lagom
6. Axon

#### 方案二：服务网格

![](../../assets/img/2022-08-07/fast_15-55-00.png)

无侵入性

![](../../assets/img/2022-08-07/fast_15-56-59.png)

![](../../assets/img/2022-08-07/fast_16-00-21.png)

![](../../assets/img/2022-08-07/fast_16-01-13.png)

#### 两种方案的对比

* 侵入（springcloud）和非侵入
* 是否支持技术异构性

#### 基于DDD思想进行服务拆分和重构

重构流程

![](../../assets/img/2022-08-07/fast_16-04-30.png)

![](../../assets/img/2022-08-07/fast_16-05-17.png)

事件总线 kafkaConsumer

#### 什么是k8s以及为什么要学

* Kubernetes是容器集群管理系统，是一个开源的平台
* 硬件资源管理调度、应用部署的事实标准
* 业务架构师需要懂运维架构