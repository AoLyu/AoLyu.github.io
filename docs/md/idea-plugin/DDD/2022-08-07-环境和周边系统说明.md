## 环境和周边系统说明

### 领域事件为什么重要

* 领域事件能够驱动建模
* 领域事件和很多重要思想相关
  * CQRS
  * Event Soucing
* 领域事件和大数据处理和分析相关



#### CQRS

读模型和写模型分开

![](../../assets/img/2022-08-07/fast_10-27-56.png)

![](../../assets/img/2022-08-07/fast_10-48-59.png)

#### 运营域

![](../../assets/img/2022-08-07/fast_10-51-43.png)

![](../../assets/img/2022-08-07/fast_10-52-58.png)

#### 内部鉴权

![](../../assets/img/2022-08-07/fast_10-54-44.png)

#### 建模工具

 ![](../../assets/img/2022-08-07/fast_10-56-37.png)

#### 云

* 云主机
* 消息队列
* 大数据处理、可视化

#### 什么是领域事件

* 领域中发生的任何领域专家感兴趣的事情
* 领域事件一般由聚合产生
* 领域事件不是技术概念

#### 事件命名和基本属性

* 命名方法
* 事件ID
* 产生时间

#### 发布和订阅方式

* 外部系统（微信支付系统）
  * API定向通知
  * API定时拉取
  * 消息队列
* 内部系统
  * 观察者模式
  * 数据库流水
  * 消息队列

#### 事件存储

* 事件使用消息中间件的存储
  * 冗余机制
  * 做好备份
* 基于数据库（mongodb，postgresql，mysql）
  * 分布式
  * 按时间区分

##### 事件处理的要求

* 顺序性
  * 聚合ID
  * 存储分片
  * 消费分组
* 幂等性----用幂等性代替分布式事务
  * 状态判断或去重

#### 领域事件和大数据分析

![](../../assets/img/2022-08-07/fast_11-12-59.png)



#### “运营域”整体架构设计

##### 上下文交互图

使用上一章学习过的分析方法，我们同样可以得到运营域的上下文交互图：

![](../../assets/img/2022-08-07/fast_11-16-10.png)

作为核心上下文，运营上下文为零售企业的业务运营人员提供运营解决方案，解决售卖机的合理投放、撤销，以及库存计划的指定和执行问题，设备上下文、商品上下文，以及客户内部的ERP上下文、配送上下文，为运营上下文提供支撑，分别解决设备的管理和操控、商品信息的获取、售卖机设备的采购和安装、商品的配送等问题。

#### 数据处理和分析

在多数系统中，数据分析是不可或缺的部分。系统上线后，在为用户提供服务的同时，会积累下来大量行为数据，这些行为数据是重要的生产原料，经过处理加工和分析之后，会成为运营决策的重要依据。snu曲1係统中，数据的处理通路如下图所示：

![](../../assets/img/2022-08-07/fast_11-18-18.png)

#### 依赖子领域的准备工作

本章的学习中，我们会通过演示对接P系统来学习防腐层的实现，因此，需要引入P的相关依赖，并了解相关概念。

##### 1.  添加依赖

代码根目录中，lib/k3cloud-webapi-sdk.7.6.x.jar对应的就是我们访问erp系统的sdk包，我们把它拷贝到自己的工程目录，在pom.xml中添加如下依赖即可：

##### 2. 接口文档地址

[金蝶云星空开放平台(kingdeecom)](https://openapi.open.kingdee.com/ApiCenterDoc?apiTopClassId=T20&apiFormId=77233047415029778&apiOperateId=81252960911753218&apiOperateUrlNumber=Save)